<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bravo CIVIL - Enterprise Full Engine v54</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.6.1/frappe-gantt.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.6.1/frappe-gantt.css">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');

body {
    font-family: 'Inter', sans-serif;
    background: #f8fafc;
    overflow: hidden;
}

.page { display:none; width:100vw; height:100vh; position:absolute; }
.page.active { display:block; }

.input-cell {
    background: transparent;
    width: 100%;
    outline: none;
    padding: 4px;
    border-radius: 4px;
    border: 1px solid transparent;
}
.input-cell:focus {
    border-color: #3b82f6;
    background: white;
}

.row-master { background:#0f172a !important; color:white; font-weight:900; }
.row-group { background:#f1f5f9 !important; font-weight:700; }

#gantt-box {
    min-height: 700px;
}

.modal {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(15,23,42,.6);
    backdrop-filter:blur(4px);
    z-index:100;
    align-items:center;
    justify-content:center;
}
.modal.active { display:flex; }
</style>
</head>

<body>

<!-- ===================== LOGIN ===================== -->
<div id="page-login" class="page active flex items-center justify-center bg-slate-900">
    <div class="bg-white p-10 rounded-[40px] shadow-2xl w-full max-w-sm text-center">
        <h1 class="text-4xl font-black italic mb-2">Bravo<span class="text-blue-600">CIVIL</span></h1>
        <p class="text-[9px] font-bold text-slate-400 uppercase mb-8">Full Engineering Suite</p>

        <input id="log-u" class="w-full border-2 p-4 rounded-2xl mb-4" placeholder="Usuário">
        <input id="log-p" type="password" class="w-full border-2 p-4 rounded-2xl mb-6" placeholder="Senha">

        <button onclick="auth.login()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl uppercase">
            Entrar
        </button>
        <p id="log-err" class="hidden text-red-500 text-[10px] font-bold mt-4">Acesso Negado</p>
    </div>
</div>

<!-- ===================== EDITOR ===================== -->
<div id="page-editor" class="page bg-white">

<header class="bg-slate-900 text-white px-6 py-3 flex justify-between items-center">
    <div class="flex items-center gap-4">
        <h2 id="edit-name" class="font-black italic uppercase">Planejamento</h2>
    </div>

    <div class="flex bg-slate-800 p-1 rounded-2xl">
        <button onclick="editor.switch('planning')" id="t-planning"
            class="px-5 py-2 text-[10px] font-black uppercase rounded-xl bg-blue-600">
            Planejamento
        </button>
        <button onclick="editor.switch('lob')" id="t-lob"
            class="px-5 py-2 text-[10px] font-black uppercase rounded-xl">
            LOB
        </button>
        <button onclick="editor.switch('dash')" id="t-dash"
            class="px-5 py-2 text-[10px] font-black uppercase rounded-xl">
            Dashboard
        </button>
    </div>
</header>

<main class="p-4 h-[calc(100vh-64px)] overflow-hidden">

<!-- ===================== PLANILHA + GANTT ===================== -->
<div id="v-planning" class="view h-full">

<div class="flex h-full gap-4">

<!-- PLANILHA -->
<div class="w-[45%] overflow-auto border rounded-xl bg-white">
    <div class="flex justify-between p-4 border-b">
        <button onclick="editor.addGroup()" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase">
            + Etapa
        </button>
    </div>

    <table class="w-full text-sm">
        <thead class="bg-slate-50 text-[10px] font-black uppercase text-slate-400">
            <tr>
                <th class="p-3">ID</th>
                <th class="p-3 text-left">Descrição</th>
                <th class="p-3">Custo</th>
                <th class="p-3">%</th>
                <th class="p-3">Início</th>
                <th class="p-3">Dias</th>
                <th class="p-3">Fim</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<!-- GANTT -->
<div class="w-[55%] border rounded-xl bg-white overflow-auto">
    <div id="gantt-box" class="p-4"></div>
</div>

</div>
</div>

<!-- ===================== OUTRAS VIEWS ===================== -->
<div id="v-lob" class="view hidden h-full">
    <canvas id="lob-chart"></canvas>
</div>

<div id="v-dash" class="view hidden h-full">
    <div id="dash-kpi" class="grid grid-cols-4 gap-6 mb-8"></div>
    <canvas id="scurve"></canvas>
</div>

</main>
</div>

<!-- ===================== SCRIPT ===================== -->
<script>
const editor = {
    db: [
        {uuid:'m', name:'OBRA', type:'master'},
        {uuid:'g1', name:'ETAPA 1', type:'group', parent:'m'},
        {uuid:'t1', name:'Fundação', type:'item', parent:'g1', start:'2026-01-01', duration:10, progress:20}
    ],

    switch(v) {
        document.querySelectorAll('.view').forEach(x => x.classList.add('hidden'));
        document.getElementById('v-'+v).classList.remove('hidden');
        if(v === 'planning') this.renderG();
    },

    addGroup() {
        this.db.push({uuid:'g'+Date.now(), name:'Nova Etapa', type:'group', parent:'m'});
        this.renderT(); this.renderG();
    },

    renderT() {
        const b = document.getElementById('tbody');
        b.innerHTML = '';
        this.db.forEach((t,i)=>{
            if(t.type==='master') return;
            b.innerHTML += `
            <tr class="${t.type==='group'?'row-group':''}">
                <td class="p-2 text-center">${i}</td>
                <td class="p-2"><input class="input-cell font-bold" value="${t.name}"></td>
                <td class="p-2 text-right">${t.cost||0}</td>
                <td class="p-2 text-center">${t.progress||0}</td>
                <td class="p-2 text-center">${t.start||''}</td>
                <td class="p-2 text-center">${t.duration||''}</td>
                <td class="p-2 text-center">${t.end||''}</td>
            </tr>`;
        });
    },

    renderG() {
        const tasks = this.db.filter(t=>t.start).map(t=>({
            id:t.uuid,
            name:t.name,
            start:t.start,
            end:this.addDays(t.start,t.duration||1),
            progress:t.progress||0
        }));
        document.getElementById('gantt-box').innerHTML = '';
        if(tasks.length) new Gantt('#gantt-box', tasks, {readonly:true});
    },

    addDays(d,n) {
        const x=new Date(d); x.setDate(x.getDate()+n);
        return x.toISOString().split('T')[0];
    }
};

window.onload = () => {
    editor.renderT();
    editor.renderG();
    lucide.createIcons();
};
</script>

</body>
</html>
