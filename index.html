<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bravo CIVIL - v145.3 (Modular)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.6.1/frappe-gantt.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.6.1/frappe-gantt.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="page-login" class="page active flex items-center justify-center bg-slate-900">
        <div class="bg-white p-10 rounded-[40px] shadow-2xl w-full max-w-sm text-center">
            <h1 class="text-4xl font-black italic mb-2 text-slate-900">Bravo<span class="text-blue-600">CIVIL</span></h1>
            <p class="text-xs text-slate-400 mb-6 font-bold uppercase">Versão 145.3 (Modular)</p>
            <input type="text" id="log-u" class="w-full border-2 p-4 rounded-2xl mb-4 text-sm" placeholder="Usuário (admin)">
            <input type="password" id="log-p" class="w-full border-2 p-4 rounded-2xl mb-6 text-sm" placeholder="Senha (123)">
            <button id="btn-login" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl uppercase text-xs hover:bg-blue-700 transition">Acessar Sistema</button>
            <p class="mt-4 text-[10px] text-slate-400">Use <strong>admin / 123</strong> para acesso local.</p>
        </div>
    </div>

    <div id="page-manager" class="page">
        <nav class="bg-white border-b px-8 py-4 flex justify-between items-center">
            <h1 class="text-xl font-black italic">Bravo<span class="text-blue-600">CIVIL</span></h1>
            <div class="flex gap-3">
                <input type="file" id="import-file" class="hidden" accept=".json">
                <button id="btn-team" class="bg-slate-100 text-slate-700 px-4 py-2 rounded-xl font-bold text-[10px] uppercase">Equipe</button>
                <button onclick="document.getElementById('import-file').click()" class="bg-slate-800 text-white px-4 py-2 rounded-xl font-bold text-[10px] uppercase flex items-center gap-2"><i data-lucide="upload" class="w-3"></i> Importar</button>
                <button id="btn-new-project" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-black text-[10px] uppercase">+ Novo Projeto</button>
                <button onclick="location.reload()" class="text-slate-400 p-2"><i data-lucide="log-out"></i></button>
            </div>
        </nav>
        <div id="grid-projects" class="max-w-6xl mx-auto p-12 grid grid-cols-1 md:grid-cols-3 gap-8"></div>
    </div>

    <div id="page-editor" class="page">
        <header class="h-16 bg-slate-900 text-white px-6 flex justify-between items-center z-50 shadow-md">
            <div class="flex items-center gap-4">
                <button id="btn-close-editor" class="p-2 hover:bg-slate-800 rounded-lg"><i data-lucide="chevron-left"></i></button>
                <h2 id="edit-name" class="font-black italic uppercase text-[10px] tracking-wider">OBRA</h2>
            </div>
            <div class="flex bg-slate-800 p-1 rounded-xl gap-1">
                <button id="btn-v-eap" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition">EAP</button>
                <button id="btn-v-main" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg bg-blue-600 text-white shadow">Cronograma</button>
                <button id="btn-v-site" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition flex items-center gap-1"><i data-lucide="hard-hat" class="w-3"></i> VISÃO OBRA</button>
                <button id="btn-v-kanban" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition">Kanban</button>
                <button id="btn-v-bal" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition">L. Balanço</button>
                <button id="btn-v-cash" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition">Financeiro</button>
                <button id="btn-v-dash" class="view-btn px-4 py-2 text-[9px] font-black uppercase rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition">Dash AI</button>
            </div>
            <div class="flex gap-2">
                <button id="btn-export-csv" class="bg-green-600 text-white p-2 rounded-lg flex items-center gap-2 px-3 hover:bg-green-500 font-bold text-[10px] uppercase" title="Exportar CSV/Excel"><i data-lucide="sheet" class="w-4"></i> Excel</button>
                <button id="btn-print" class="bg-pink-600 text-white p-2 rounded-lg flex items-center gap-2 px-3 hover:bg-pink-500 font-bold text-[10px] uppercase" title="Exportar PDF"><i data-lucide="printer" class="w-4"></i> PDF</button>
                <button id="btn-snapshots" class="bg-indigo-600 text-white p-2 rounded-lg flex items-center gap-2 px-3 hover:bg-indigo-500 font-bold text-[10px] uppercase"><i data-lucide="history" class="w-4"></i> Versões</button>
                <button id="btn-config" class="p-2 bg-slate-800 rounded-lg text-white hover:bg-slate-700"><i data-lucide="settings" class="w-4"></i></button>
            </div>
        </header>

        <main id="editor-content" class="bg-white h-[calc(100vh-64px)] overflow-hidden">
            <div id="v-main" class="view h-full flex flex-col">
                <div class="bg-white border-b p-2 flex justify-between items-center h-[50px] flex-shrink-0 no-print">
                    <div class="flex gap-2 items-center">
                        <button id="btn-add-group" class="bg-slate-800 text-white text-[9px] px-3 py-1.5 rounded font-black uppercase hover:bg-slate-700 flex gap-1 items-center shadow"><i data-lucide="folder-plus" class="w-3"></i> + Grupo</button>
                        <div class="h-6 w-[1px] bg-slate-200 mx-2"></div>
                        <button id="btn-link-mode" class="bg-slate-200 text-slate-600 text-[9px] px-3 py-1.5 rounded font-black uppercase flex gap-1 items-center hover:bg-slate-300 transition border border-slate-300 shadow-sm">
                            <i data-lucide="link" class="w-3"></i> <span>LIGAR TAREFAS</span>
                        </button>
                        <div class="h-6 w-[1px] bg-slate-200 mx-2"></div>
                        <button id="btn-collapse-all" class="bg-slate-100 text-slate-600 text-[9px] px-3 py-1.5 rounded font-black uppercase">Recolher</button>
                        <button id="btn-expand-all" class="bg-slate-100 text-slate-600 text-[9px] px-3 py-1.5 rounded font-black uppercase">Expandir</button>
                        <div class="h-6 w-[1px] bg-slate-200 mx-2"></div>
                        <button id="btn-toggle-mode" class="bg-blue-500 text-white text-[9px] px-3 py-1.5 rounded font-black uppercase flex gap-1 items-center hover:bg-blue-600 shadow-sm transition"><i data-lucide="activity" class="w-3"></i> <span id="mode-label">MODO PADRÃO</span></button>
                        <div id="measurement-controls" class="hidden flex gap-2 ml-2 animate-fade-in bg-slate-100 p-1 rounded-lg border border-slate-200">
                            </div>
                        <button id="btn-recalc" class="bg-orange-500 text-white text-[9px] px-3 py-1.5 rounded font-black uppercase flex gap-1 items-center hover:bg-orange-600 shadow-sm ml-2" title="Reprogramar saldo"><i data-lucide="refresh-cw" class="w-3"></i> RECALCULAR</button>
                    </div>
                    <div class="flex items-center gap-4 bg-slate-50 border px-3 py-1 rounded-lg">
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-blue-500 rounded"></div><span class="text-[9px] font-bold text-slate-600 uppercase">Planejado</span></div>
                        <div class="flex items-center gap-1"><div class="w-3 h-2 bg-green-700 rounded"></div><span class="text-[9px] font-bold text-slate-600 uppercase">Executado</span></div>
                        <div class="flex items-center gap-1"><div class="w-3 h-1 bg-slate-400 rounded"></div><span class="text-[9px] font-bold text-slate-600 uppercase">Baseline</span></div>
                    </div>
                    <div class="flex gap-1 bg-slate-100 p-1 rounded">
                        <button onclick="editor.changeGanttMode('Day')" class="text-[9px] font-bold px-3 py-1 hover:bg-white rounded transition">Dia</button>
                        <button onclick="editor.changeGanttMode('Week')" class="text-[9px] font-bold px-3 py-1 hover:bg-white rounded transition">Sem</button>
                        <button onclick="editor.changeGanttMode('Month')" class="text-[9px] font-bold px-3 py-1 hover:bg-white rounded transition">Mês</button>
                    </div>
                </div>
                <div class="master-grid flex-grow overflow-hidden relative">
                    <div id="wrapper-table">
                        <table class="w-full">
                            <thead class="bg-slate-50 text-[9px] font-black uppercase text-slate-400 border-b">
                                <tr id="table-head-row"></tr>
                            </thead>
                            <tbody id="tbody"></tbody>
                        </table>
                        <div class="scroll-spacer"></div>
                    </div>
                    <div id="wrapper-gantt">
                        <div id="gantt-box" class="h-full w-full"></div>
                        <div class="scroll-spacer"></div>
                    </div>
                </div>
            </div>
            
            <div id="v-site" class="view hidden p-8 bg-slate-50 h-full overflow-y-auto">
                <div class="flex justify-between items-center mb-8 border-b pb-4">
                    <div><h2 class="text-3xl font-black italic text-slate-800 uppercase">Visão de Campo</h2><p class="text-xs text-slate-500 font-bold uppercase mt-1">Relatório de Status da Obra</p></div>
                    <div class="text-right"><div class="text-[10px] uppercase font-bold text-slate-400">Data de Referência</div><div class="text-xl font-black text-slate-800" id="site-date"></div></div>
                </div>
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl border-l-4 border-red-500 shadow-sm"><div class="text-[10px] uppercase font-bold text-slate-400 mb-1">Itens Atrasados</div><div class="text-3xl font-black text-red-600" id="site-delay-count">0</div></div>
                    <div class="bg-white p-6 rounded-2xl border-l-4 border-blue-500 shadow-sm"><div class="text-[10px] uppercase font-bold text-slate-400 mb-1">Previsto no Mês</div><div class="text-3xl font-black text-blue-600" id="site-month-count">0</div></div>
                    <div class="bg-white p-6 rounded-2xl border-l-4 border-green-500 shadow-sm"><div class="text-[10px] uppercase font-bold text-slate-400 mb-1">Avanço Global</div><div class="text-3xl font-black text-green-600" id="site-global-prog">0%</div></div>
                </div>
                <div class="bg-white rounded-2xl shadow-sm border mb-8 overflow-hidden">
                    <div class="bg-red-50 p-4 border-b border-red-100 flex items-center gap-2"><i data-lucide="alert-triangle" class="w-5 h-5 text-red-600"></i><h3 class="font-black text-red-700 uppercase text-xs">Itens em Atraso (Crítico)</h3></div>
                    <div class="p-0"><table class="w-full text-left text-xs"><thead class="bg-slate-50 text-slate-500 uppercase font-bold border-b"><tr><th class="p-3">Grupo / Serviço</th><th class="p-3">Pavimento (Item)</th><th class="p-3 text-center">Data Fim (Cronograma)</th><th class="p-3 text-center">Dias de Atraso</th><th class="p-3 text-center">Status Físico</th></tr></thead><tbody id="site-delay-table" class="divide-y divide-slate-100"></tbody></table></div>
                </div>
                <div class="bg-white rounded-2xl shadow-sm border mb-8 overflow-hidden">
                    <div class="bg-blue-50 p-4 border-b border-blue-100 flex items-center gap-2"><i data-lucide="calendar" class="w-5 h-5 text-blue-600"></i><h3 class="font-black text-blue-700 uppercase text-xs">Planejamento do Mês Atual</h3></div>
                    <div class="p-0"><table class="w-full text-left text-xs"><thead class="bg-slate-50 text-slate-500 uppercase font-bold border-b"><tr><th class="p-3">Grupo / Serviço</th><th class="p-3">Pavimento (Item)</th><th class="p-3 text-center">Início</th><th class="p-3 text-center">Fim</th></tr></thead><tbody id="site-month-table" class="divide-y divide-slate-100"></tbody></table></div>
                </div>
            </div>

            <div id="v-eap" class="view hidden h-full w-full relative overflow-hidden">
                <div class="absolute top-4 left-4 z-50 flex gap-2"><button id="btn-eap-add" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase shadow-lg hover:bg-slate-800 transition">+ Balão</button><div class="bg-white flex rounded-xl shadow border"><button onclick="editor.zoom(0.1)" class="px-3 border-r hover:bg-slate-100"><i data-lucide="zoom-in" class="w-4"></i></button><button onclick="editor.zoom(-0.1)" class="px-3 border-r hover:bg-slate-100"><i data-lucide="zoom-out" class="w-4"></i></button><button onclick="editor.resetZoom()" class="px-3 text-[10px] font-bold hover:bg-slate-100">100%</button></div></div>
                <div id="eap-viewport"><div id="eap-canvas"><svg id="eap-svg" class="absolute inset-0 w-full h-full pointer-events-none z-10 overflow-visible"></svg><div id="eap-nodes-layer" class="absolute inset-0 z-20"></div></div></div>
            </div>

            <div id="v-kanban" class="view hidden p-8 bg-slate-100 h-full overflow-x-auto">
                <div class="flex gap-6 h-full">
                    <div class="bg-slate-200 p-4 rounded-xl min-w-[300px] flex flex-col h-full"><h4 class="font-black text-[10px] mb-4 uppercase">A Fazer <button onclick="editor.addKb('todo')" class="ml-2">+</button></h4><div id="kb-todo" class="space-y-3 overflow-y-auto flex-grow min-h-0"></div></div>
                    <div class="bg-blue-50 p-4 rounded-xl min-w-[300px] flex flex-col h-full"><h4 class="font-black text-[10px] mb-4 uppercase text-blue-600">Em Andamento <button onclick="editor.addKb('doing')" class="ml-2">+</button></h4><div id="kb-doing" class="space-y-3 overflow-y-auto flex-grow min-h-0"></div></div>
                    <div class="bg-green-50 p-4 rounded-xl min-w-[300px] flex flex-col h-full"><h4 class="font-black text-[10px] mb-4 uppercase text-green-600">Concluído <button onclick="editor.addKb('done')" class="ml-2">+</button></h4><div id="kb-done" class="space-y-3 overflow-y-auto flex-grow min-h-0"></div></div>
                </div>
            </div>

            <div id="v-dash" class="view hidden p-10 bg-white h-full overflow-y-auto"><div class="flex justify-between items-end mb-8"><h2 class="text-2xl font-black italic text-slate-800">Visão Estratégica</h2><span class="text-[10px] font-bold bg-blue-100 text-blue-700 px-3 py-1 rounded-full uppercase">IA v145.3</span></div><div class="ai-panel p-8 rounded-2xl shadow-sm mb-10 relative overflow-hidden"><h3 class="font-black text-blue-600 uppercase text-xs mb-4 flex items-center gap-2"><i data-lucide="sparkles" class="w-4"></i> Análise Narrativa da IA</h3><div id="ai-narrative-content" class="text-slate-700 text-sm leading-relaxed font-medium space-y-2">Calculando...</div></div><div class="grid grid-cols-4 gap-6 mb-10" id="dash-kpi"></div><div class="grid grid-cols-2 gap-8"><div class="border p-6 rounded-[30px] bg-slate-50 h-96 flex flex-col shadow-sm"><h4 class="font-black text-[10px] mb-4 uppercase">Curva S</h4><div class="flex-grow relative h-full w-full"><canvas id="scurve-chart"></canvas></div></div><div class="border p-6 rounded-[30px] bg-slate-50 h-96 flex flex-col shadow-sm"><h4 class="font-black text-[10px] mb-4 uppercase">Status</h4><div class="flex-grow relative h-full w-full"><canvas id="pie-chart"></canvas></div></div></div></div>
            <div id="v-bal" class="view hidden h-full flex bg-slate-50"><div class="w-3/4 p-6 overflow-y-auto"><div class="h-[600px] border p-6 rounded-3xl bg-white shadow-sm relative"><div class="flex justify-between items-center mb-6"><h3 class="font-black text-[11px] uppercase text-blue-600">Linha de Balanço</h3><span class="text-[10px] bg-yellow-100 text-yellow-800 px-2 py-1 rounded font-bold">Exibindo apenas Pendentes (< 100%)</span></div><div class="absolute inset-x-6 bottom-6 top-16"><canvas id="balance-chart"></canvas></div></div></div><div class="w-1/4 p-6 border-l bg-white overflow-y-auto"><h3 class="font-black text-[11px] uppercase mb-4 text-slate-800 flex items-center gap-2"><i data-lucide="zap" class="w-4 text-yellow-500"></i> Alertas de Fluxo</h3><div id="lob-alerts" class="space-y-3 text-xs"></div></div></div>
            <div id="v-cash" class="view hidden p-10 bg-white h-full overflow-y-auto"><div class="max-w-6xl mx-auto"><h2 class="text-3xl font-black text-slate-800 mb-2">Fluxo de Caixa</h2><p class="text-slate-400 text-xs mb-10">Clique em uma barra para ver o detalhamento.</p><div class="h-[500px] border p-4 rounded-2xl shadow-sm"><canvas id="cash-chart"></canvas></div></div></div>
        </main>
    </div>

    <div id="modal-create-type" class="modal"><div class="bg-white p-8 rounded-[30px] w-[500px] shadow-2xl flex flex-col items-center"><h2 class="text-xl font-black text-slate-800 mb-6 uppercase">Como deseja criar?</h2><div class="grid grid-cols-2 gap-4 w-full mb-6"><button id="btn-create-manual" class="bg-slate-100 hover:bg-slate-200 p-6 rounded-2xl flex flex-col items-center gap-3 border-2 border-transparent hover:border-slate-300 transition"><i data-lucide="file-plus" class="w-8 h-8 text-slate-500"></i><span class="text-xs font-black uppercase text-slate-700">Manual (Branco)</span></button><button id="btn-create-wizard" class="bg-blue-50 hover:bg-blue-100 p-6 rounded-2xl flex flex-col items-center gap-3 border-2 border-transparent hover:border-blue-300 transition"><i data-lucide="bot" class="w-8 h-8 text-blue-600"></i><span class="text-xs font-black uppercase text-blue-700">Assistente (IA)</span></button></div><button onclick="document.getElementById('modal-create-type').classList.remove('active')" class="text-slate-400 text-xs font-bold uppercase">Cancelar</button></div></div>
    
    <div id="modal-create-project" class="modal"><div class="bg-white p-8 rounded-[30px] w-[500px] shadow-2xl border-2 border-blue-500 flex flex-col max-h-[90vh]"><h3 class="font-black text-blue-600 mb-2 uppercase text-xs">Assistente de Criação</h3><h2 class="text-2xl font-black text-slate-800 mb-6">Novo Projeto</h2><div class="flex-grow overflow-y-auto pr-2 space-y-4"><div class="grid grid-cols-2 gap-4"><div class="col-span-2"><label class="block text-[10px] font-bold uppercase text-slate-500 mb-1">Nome da Obra</label><input type="text" id="cp-name" class="w-full border p-2 rounded-lg text-sm font-bold" placeholder="Ex: Residencial Vista"></div><div><label class="block text-[10px] font-bold uppercase text-slate-500 mb-1">Data Início</label><input type="date" id="cp-start" class="w-full border p-2 rounded-lg text-sm"></div><div><label class="block text-[10px] font-bold uppercase text-slate-500 mb-1">Subsolos</label><input type="number" id="cp-subs" class="w-full border p-2 rounded-lg text-sm" value="0" min="0"></div><div class="flex items-center gap-2 border p-2 rounded-lg"><input type="checkbox" id="cp-ground" checked class="w-4 h-4"><label for="cp-ground" class="text-xs font-bold text-slate-700">Possui Térreo?</label></div><div><label class="block text-[10px] font-bold uppercase text-slate-500 mb-1">Garagens (Sobressolo)</label><input type="number" id="cp-garage" class="w-full border p-2 rounded-lg text-sm" value="0" min="0"></div><div class="flex items-center gap-2 border p-2 rounded-lg col-span-2"><input type="checkbox" id="cp-lazer" class="w-4 h-4"><label for="cp-lazer" class="text-xs font-bold text-slate-700">Pavimento Lazer / PUC?</label></div><div><label class="block text-[10px] font-bold uppercase text-slate-500 mb-1">Pavimentos Tipo</label><input type="number" id="cp-tipo" class="w-full border p-2 rounded-lg text-sm" value="1" min="1"></div><div class="flex flex-col gap-2"><div class="flex items-center gap-2"><input type="checkbox" id="cp-rooftop" class="w-4 h-4"><label for="cp-rooftop" class="text-xs font-bold text-slate-700">Rooftop?</label></div><div class="flex items-center gap-2"><input type="checkbox" id="cp-water" checked class="w-4 h-4"><label for="cp-water" class="text-xs font-bold text-slate-700">Barrilete/Cx. D'água</label></div></div></div></div><button id="btn-generate-project" class="w-full mt-6 bg-blue-600 text-white py-3 rounded-xl font-black text-xs uppercase hover:bg-blue-700 shadow-lg">GERAR CRONOGRAMA</button><button onclick="document.getElementById('modal-create-project').classList.remove('active')" class="w-full mt-2 text-slate-400 text-[9px] font-bold uppercase">Cancelar</button></div></div>
    <div id="modal-users" class="modal"><div class="bg-white p-8 rounded-[30px] w-96"><h3 class="font-black text-blue-600 mb-6 uppercase text-xs">Equipe</h3><div id="user-list" class="space-y-2 mb-6 max-h-48 overflow-y-auto"></div><div class="space-y-2 border-t pt-4"><input type="text" id="nu-u" placeholder="User" class="w-full border p-2 rounded text-xs"><input type="text" id="nu-p" placeholder="Pass" class="w-full border p-2 rounded text-xs"><button onclick="userManager.add()" class="w-full bg-slate-900 text-white py-2 rounded font-black text-[10px]">Add</button></div><button onclick="document.getElementById('modal-users').classList.remove('active')" class="w-full mt-4 text-xs">Fechar</button></div></div>
    
    <script type="module" src="js/main.js"></script>
</body>
</html>